# OpenLink v1.6.0 Roadmap

## 0. Host Session Management & Notifications

### Session Control Features
- **Kick Connection**: Disconnect specific connected clients
- **Change Password**: Update session password mid-session, notify connected clients
- **Regenerate Link**: Create new session ID/link, push to connected devices
- **Push to Dashboard**: Sync session info to user's dashboard and other devices

### Notifications (Local Device)
When hosting:
- "Host session started via [API/Remote/User Interface]"
- "You've started a remote session from your connected device"
- "[Device Name] from [Location] connected"
- "[Device Name] disconnected"
- "Session password changed"
- "Session link regenerated - new link: openlink://join/xxx"

### SMS Notifications & Security
- **Send via SMS**: Push session link/info to user's connected phone number
- **Unknown Device Alert**: SMS verification - "Is this you connecting to your device remotely? Reply YES or NO"
- **2FA for Connections**: Require SMS code for unknown devices

### Monitoring Services
- **openlink_monitor**: Local device monitoring daemon
  - Tracks all connection attempts
  - Logs session activity
  - Reports to hub
- **api_monitor**: Server-side hub service
  - Central monitoring dashboard
  - Cross-device session tracking
  - Security alerts aggregation
  - SMS gateway integration

### Implementation
```javascript
// Notification types
const SESSION_NOTIFICATIONS = {
    HOST_STARTED: 'host_started',
    HOST_STARTED_REMOTE: 'host_started_remote',
    CLIENT_CONNECTED: 'client_connected',
    CLIENT_DISCONNECTED: 'client_disconnected',
    PASSWORD_CHANGED: 'password_changed',
    LINK_REGENERATED: 'link_regenerated',
    SESSION_ENDED: 'session_ended',
    UNKNOWN_DEVICE: 'unknown_device',
    SMS_VERIFICATION_SENT: 'sms_verification_sent'
};

// SMS notification for unknown device
async function sendUnknownDeviceAlert(phoneNumber, deviceInfo) {
    const message = `OpenLink Security Alert: Unknown device "${deviceInfo.name}" from ${deviceInfo.location} is trying to connect. Reply YES to allow or NO to block.`;
    await smsService.send(phoneNumber, message);
}

// Monitor service integration
class OpenLinkMonitor {
    logConnectionAttempt(data) { /* local logging */ }
    reportToHub(event) { /* send to api_monitor */ }
    checkDeviceKnown(deviceId) { /* verify against trusted list */ }
}
```

### API Monitor Endpoints
```javascript
// Hub service endpoints
POST /api/monitor/event     // Log event from device
GET  /api/monitor/sessions  // Get all active sessions across devices
POST /api/monitor/sms/send  // Send SMS notification
GET  /api/monitor/alerts    // Get security alerts
POST /api/monitor/verify    // Verify SMS response
POST /api/monitor/sms/reply // Handle incoming SMS replies
```

### SMS Reply Processing
- Check incoming SMS replies for verification responses
- "YES" - Allow connection, add device to trusted
- "NO" - Block connection, log security event
- "BLOCK" - Block device permanently
- "Hey Ollama?" or "Ollama?" - Start AI assistant conversation

### Ollama SMS Bot
Trigger phrases for AI assistant (for safety, requires trigger before bot responds):
- "Hey Ollama?" - Activates conversational mode
- "Ollama?" - Quick command mode

Example commands after trigger:
- "Ollama? status" - Get current session status
- "Ollama? kick all" - Disconnect all remote users
- "Ollama? who is connected" - List connected devices
- "Ollama? block [device]" - Block specific device
- "Ollama? help" - Get list of commands
- "Hey Ollama? How do I share my screen?" - Free-form question

```javascript
// SMS Ollama Handler - requires trigger phrase for safety
const OLLAMA_TRIGGERS = [/^hey ollama\?/i, /^ollama\?/i];

async function handleOllamaSMS(phoneNumber, message) {
    // Check for trigger phrase
    const isTrigger = OLLAMA_TRIGGERS.some(t => t.test(message));
    if (!isTrigger) return null; // Not an Ollama message

    const query = message.replace(/^(hey )?ollama\?\s*/i, '');

    // Pre-defined commands
    if (query.match(/^status/i)) {
        return await getSessionStatusSMS();
    }
    if (query.match(/^kick all/i)) {
        await kickAllConnections();
        return 'All remote users disconnected.';
    }

    // Free-form Ollama query
    const response = await ollamaService.query(query, {
        context: 'OpenLink remote desktop management via SMS'
    });
    return response.substring(0, 160); // SMS length limit
}
```

## 0.5 Seamless Update System (Windows Focus)

### Problem
- Windows updater doesn't kill app properly before updating
- Sometimes gives uninstall errors during update
- Connection lost during updates

### Solution: Update Helper App
A secondary lightweight app (`OpenLink-UpdateHelper.exe`) that:
1. Takes over active session during update
2. Maintains connection while main app updates
3. Transfers connection back to updated main app
4. No connection interruption for remote user

### Update Flow
```
1. Update available detected
2. Main app spawns UpdateHelper
3. UpdateHelper connects to signaling server
4. Session handoff: Main -> UpdateHelper
5. Main app closes for update
6. NSIS installer runs silently
7. Updated main app launches
8. Session handoff: UpdateHelper -> Main
9. UpdateHelper exits
10. Connection continues seamlessly
```

### Implementation
```javascript
// update-helper.js - Minimal Electron app
class UpdateHelper {
    async takeOverSession(sessionId, signalServer) {
        // Connect to existing session
        // Notify remote client of temporary handoff
        // Maintain WebRTC connection
    }

    async handBackSession(mainAppPort) {
        // Signal main app ready
        // Transfer WebRTC peer connection
        // Graceful disconnect
    }
}
```

### Files
- `update-helper/main.js` - Minimal main process
- `update-helper/preload.js` - Session transfer bridge
- `update-helper/package.json` - Separate build config
- `scripts/windows-update.nsi` - NSIS script with helper integration

## 1. Remote SSH Installation & Terminal Access

### Overview
Add ability to install and configure OpenSSH on remote Windows machines directly from the OpenLink UI when connected. This provides a fallback for remote access when screen sharing isn't working.

### Features

#### 1.1 SSH Installation (Connection Menu)
- **Install SSH** button in connection menu when connected to Windows
- Automatically runs PowerShell commands to:
  ```powershell
  # Install OpenSSH Server
  Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0

  # Start and configure service
  Start-Service sshd
  Set-Service -Name sshd -StartupType 'Automatic'

  # Configure firewall
  New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
  ```
- Progress indicator during installation
- Notification when complete

#### 1.2 Terminal Access Panel
- New "Terminal" tab when connected to remote machine
- SSH connection using machine credentials
- Command history with up/down arrow navigation
- Copy/paste support for commands and output

#### 1.3 Quick Commands Menu
Popular commands available with button press:
- **System Info**: `systeminfo`, `hostname`, `whoami`
- **Network**: `ipconfig /all`, `netstat -an`, `ping`
- **Processes**: `tasklist`, `Get-Process`
- **Services**: `Get-Service`, `net start/stop`
- **File Operations**: `dir`, `cd`, `copy`, `move`
- **Windows Update**: `wuauclt /detectnow`
- **Restart/Shutdown**: `shutdown /r /t 0`, `shutdown /s /t 0`

#### 1.4 Fallback Mode
- Automatically offer SSH terminal when screen sharing fails
- "Connection issues? Try terminal mode" prompt
- Persist SSH credentials for quick reconnection

### Implementation Files
- `src/ui/terminal-panel.js` - Terminal UI component
- `src/services/ssh-manager.js` - SSH connection handling
- `src/services/remote-ssh-installer.js` - Remote SSH installation
- `src/ui/quick-commands.js` - Quick command buttons

---

## 2. Settings Reorganization

### Current Issues
- Duplicate clipboard settings entries
- Settings spread across different sections
- Inconsistent grouping

### New Settings Structure

#### 2.1 Connection Settings
- Server selection
- Auto-reconnect options
- Connection timeout
- Fallback server list

#### 2.2 Hosting Settings
- Connection permissions (Always/Ask/Never)
- Auto-host on startup
- Session ID format (random/custom)
- Password protection

#### 2.3 Audio & Media
- Share system audio
- Microphone settings
- Remote volume control
- Local volume control
- Auto-enable media

#### 2.4 Clipboard & Files
- Enable clipboard sharing (single setting, remove duplicates)
- Enable file sharing
- Shared files location
- Maximum file size

#### 2.5 Accessibility
- Screen reader options
- Speech rate slider with test button
- Voice selection dropdown:
  - System voices (macOS/Windows built-in)
  - TTS server voices (remote)
  - Local TTS server (if installed)
  - Piper TTS voices (bundled option)
- Test text: "This is a test. This is what the system speech will sound like when using your local voice with the remote screen reader. You can change this at any time."
- High contrast mode
- Keyboard navigation enhancements

#### 2.6 Display
- Theme (Light/Dark/System)
- Window behavior
- Tray icon options

#### 2.7 Updates
- Auto-update preference
- Update channel (Stable/Beta)
- Check frequency

#### 2.8 Advanced
- Developer options
- Logging level
- Network diagnostics
- Reset to defaults

---

## 3. TTS Voice Management

### Voice Sources
1. **System Voices**
   - macOS: `NSSpeechSynthesizer` voices
   - Windows: SAPI voices
   - Auto-detect available voices

2. **Remote TTS Server**
   - Connect to hosted TTS API
   - Stream audio for remote speech

3. **Local TTS Server**
   - Optional local installation
   - Piper TTS integration
   - Offline capability

4. **Bundled Voices**
   - Include Piper TTS binaries
   - Pre-packaged voice models
   - First-run voice download option

### Voice Settings UI
```
Voice Selection:
[Dropdown: System Default (Alex) â–¼]
  - System Voices
    - Alex (macOS)
    - Samantha (macOS)
    - ...
  - Server Voices
    - Neural Voice 1
    - Neural Voice 2
  - Local TTS
    - Piper English (if installed)
    - [Install Local TTS...]

Speech Rate: [====|=====] 1.0x
[Test Voice] - Plays: "This is a test. This is what..."

[] Use remote TTS server for screen reader
[] Install local TTS for offline use
```

---

## 4. API Improvements

### Session Management API
```javascript
// Create session
POST /api/session
{ hostType: 'windows|mac|linux', features: ['screen', 'audio', 'input'] }

// Get session info
GET /api/session/:sessionId

// List active sessions
GET /api/sessions

// End session
DELETE /api/session/:sessionId
```

### Remote Command API
```javascript
// Execute command on remote machine
POST /api/session/:sessionId/command
{ command: 'ipconfig', elevated: false }

// Install SSH on remote
POST /api/session/:sessionId/install-ssh

// Get command history
GET /api/session/:sessionId/commands
```

---

## 5. Implementation Priority

1. **High Priority**
   - Settings reorganization (remove duplicates)
   - SSH installation feature
   - Quick commands

2. **Medium Priority**
   - Terminal panel
   - Voice selection improvements
   - API enhancements

3. **Low Priority**
   - Bundled TTS voices
   - Advanced network diagnostics

---

## 6. File Changes Required

### New Files
- `src/ui/terminal-panel.js`
- `src/ui/terminal-panel.css`
- `src/services/ssh-manager.js`
- `src/services/remote-ssh-installer.js`
- `src/ui/quick-commands.js`
- `src/services/tts-manager.js`
- `src/services/voice-detector.js`

### Modified Files
- `src/ui/app.js` - Settings reorganization
- `src/ui/index.html` - New settings structure
- `src/ui/styles.css` - Terminal and settings styles
- `src/main.js` - TTS and SSH handlers
- `src/preload.js` - New IPC methods

---

## 7. Testing Checklist

- [ ] Settings load correctly after reorganization
- [ ] No duplicate settings entries
- [ ] SSH installs successfully on Windows 10/11
- [ ] Terminal connects after SSH installation
- [ ] Quick commands execute properly
- [ ] Voice selection shows all available voices
- [ ] Speech rate test plays correctly
- [ ] TTS server fallback works
- [ ] API endpoints return correct responses
